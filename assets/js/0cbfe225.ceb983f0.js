"use strict";(self.webpackChunkmithril=self.webpackChunkmithril||[]).push([[838],{4:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"desenvolvimento/blockchain","title":"Implementa\xe7\xe3o de Blockchain Stellar","description":"Esta se\xe7\xe3o documenta a integra\xe7\xe3o da plataforma Mithril com a blockchain Stellar (Soroban). Toda a implementa\xe7\xe3o de contratos e integra\xe7\xf5es on-chain foi programada em Rust (Soroban).","source":"@site/docs/desenvolvimento/blockchain.md","sourceDirName":"desenvolvimento","slug":"/desenvolvimento/blockchain","permalink":"/Mithril/docs/desenvolvimento/blockchain","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/desenvolvimento/blockchain.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Implementa\xe7\xe3o de Blockchain Stellar","label":"Implementa\xe7\xe3o de Blockchain Stellar"},"sidebar":"tutorialSidebar","previous":{"title":"Primeira Vers\xe3o do Front-End","permalink":"/Mithril/docs/desenvolvimento/primeira-versao-front"},"next":{"title":"Banco de Dados","permalink":"/Mithril/docs/desenvolvimento/banco-de-dados"}}');var r=i(4848),a=i(8453);const o={sidebar_position:2,title:"Implementa\xe7\xe3o de Blockchain Stellar",label:"Implementa\xe7\xe3o de Blockchain Stellar"},l=void 0,c={},d=[{value:"Contratos inteligentes",id:"contratos-inteligentes",level:2},{value:"CreditScore",id:"creditscore",level:3},{value:"Governance",id:"governance",level:3},{value:"Loan",id:"loan",level:3},{value:"Deploy, inicializa\xe7\xe3o e integra\xe7\xe3o",id:"deploy-inicializa\xe7\xe3o-e-integra\xe7\xe3o",level:2},{value:"Wallets (crate <code>wallets</code>)",id:"wallets-crate-wallets",level:2},{value:"Refer\xeancias r\xe1pidas",id:"refer\xeancias-r\xe1pidas",level:2},{value:"Pr\xf3ximos passos",id:"pr\xf3ximos-passos",level:2}];function t(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Esta se\xe7\xe3o documenta a integra\xe7\xe3o da plataforma Mithril com a blockchain Stellar (Soroban). Toda a implementa\xe7\xe3o de contratos e integra\xe7\xf5es on-chain foi programada em Rust (Soroban)."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Autentica\xe7\xe3o e gest\xe3o de carteiras (wallets) na Stellar."}),"\n",(0,r.jsx)(n.li,{children:"Contratos inteligentes para score de cr\xe9dito, governan\xe7a e empr\xe9stimos."}),"\n",(0,r.jsx)(n.li,{children:"Scripts de deploy, inicializa\xe7\xe3o e testes de fluxo ponta a ponta."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Arquitetura on-chain principal:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"credit_score"}),": calcula e armazena score de cr\xe9dito com base em dados on-chain e off-chain."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"governance"}),": mant\xe9m configura\xe7\xe3o de taxas e fundo de prote\xe7\xe3o."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"loan"}),": gerencia cards de investimento/solicita\xe7\xe3o, cria\xe7\xe3o de empr\xe9stimos e pagamentos."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"wallets"})," (crate separada): utilit\xe1rios para cria\xe7\xe3o/gerenciamento de wallets de Investidor e Tomador."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"C\xf3digos relevantes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Contratos: ",(0,r.jsx)(n.code,{children:"src/stellar/contracts/{credit_score,governance,loan}"})]}),"\n",(0,r.jsxs)(n.li,{children:["Deploy/integra\xe7\xe3o: ",(0,r.jsx)(n.code,{children:"src/stellar/contracts/deploy/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Wallets: ",(0,r.jsx)(n.code,{children:"src/stellar/wallets/"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"contratos-inteligentes",children:"Contratos inteligentes"}),"\n",(0,r.jsx)(n.h3,{id:"creditscore",children:"CreditScore"}),"\n",(0,r.jsx)(n.p,{children:"Responsabilidades:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Inicializa\xe7\xe3o com admin."}),"\n",(0,r.jsx)(n.li,{children:"C\xe1lculo de score final combinando dados on-chain e off-chain."}),"\n",(0,r.jsx)(n.li,{children:"Registro de pagamentos para alimentar hist\xf3rico e inadimpl\xeancia."}),"\n",(0,r.jsx)(n.li,{children:"Consulta de score e verifica\xe7\xe3o de elegibilidade de cr\xe9dito."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Principais entradas/sa\xeddas (APIs p\xfablicas):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"initialize(admin: Address)"})," \u2014 define admin."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"update_credit_score(user: Address, off_chain_data: OffChainData, credit_bureau_score: u32) -> CreditScore"})," \u2014 recalcula e persiste score."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"record_payment(user: Address, loan_id: u64, amount: i128, on_time: bool)"})," \u2014 registra pagamento (chamado pelo contrato de empr\xe9stimo)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"get_score(user: Address) -> Option<CreditScore>"})," \u2014 retorna score completo."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"can_borrow(user: Address, amount: i128) -> bool"})," \u2014 valida elegibilidade por faixa de risco/valor."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"set_loan_contract(loan_contract: Address)"})," \u2014 configura contrato de empr\xe9stimo autorizado a registrar pagamentos."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"get_payment_history(user: Address) -> Option<Vec<PaymentRecord>>"})," \u2014 hist\xf3rico do usu\xe1rio."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Tipos relevantes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"CreditScore { user, score, risk_level, on_chain_score, off_chain_score, payment_history, total_transactions, default_count, last_updated }"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"OffChainData { bank_statements, pix_history, invoices, credit_bureau }"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"PaymentRecord { loan_id, amount, on_time, timestamp }"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"RiskLevel = Low | Medium | High"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Observa\xe7\xf5es:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pondera\xe7\xf5es de c\xe1lculo est\xe3o no m\xf3dulo ",(0,r.jsx)(n.code,{children:"calculator"})," e usam pesos distintos para on-chain/off-chain/pontualidade."]}),"\n",(0,r.jsxs)(n.li,{children:["Autoriza\xe7\xe3o: ",(0,r.jsx)(n.code,{children:"initialize"})," exige ",(0,r.jsx)(n.code,{children:"admin.require_auth()"}),". ",(0,r.jsx)(n.code,{children:"record_payment"})," exige que o ",(0,r.jsx)(n.code,{children:"LOAN_CONTRACT"})," esteja configurado e autorize a chamada."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"governance",children:"Governance"}),"\n",(0,r.jsx)(n.p,{children:"Responsabilidades:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Armazenar configura\xe7\xe3o de taxas (transa\xe7\xe3o e g\xe1s) e gerenciar o fundo de prote\xe7\xe3o."}),"\n",(0,r.jsx)(n.li,{children:"Cobran\xe7a de taxas usando o token configurado."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Principais entradas/sa\xeddas (APIs p\xfablicas):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"initialize(admin: Address, token: Address, transaction_fee: u32, gas_fee: u32)"})," \u2014 configura admin, token e taxas (basis points)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"collect_transaction_fee(from: Address, amount: i128) -> i128"})," \u2014 calcula e transfere taxa de transa\xe7\xe3o para o contrato de governan\xe7a."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"collect_gas_fee(from: Address, amount: i128) -> i128"})," \u2014 calcula e transfere taxa de g\xe1s para o fundo de prote\xe7\xe3o."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Tipos relevantes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"FeeConfig { transaction_fee, gas_fee, last_updated }"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"ProtectionFund { total_balance, total_claims, active_claims }"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Observa\xe7\xf5es:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["O contrato espera um ",(0,r.jsx)(n.code,{children:"token"})," compat\xedvel com o client ",(0,r.jsx)(n.code,{children:"soroban_sdk::token::Client"})," para movimenta\xe7\xe3o de valores."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"loan",children:"Loan"}),"\n",(0,r.jsx)(n.p,{children:"Responsabilidades:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Inicializa\xe7\xe3o referenciando ",(0,r.jsx)(n.code,{children:"token"}),", ",(0,r.jsx)(n.code,{children:"governance"})," e ",(0,r.jsx)(n.code,{children:"credit_score"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Cria\xe7\xe3o de cards: ",(0,r.jsx)(n.code,{children:"Investment"})," (oferta do investidor) e ",(0,r.jsx)(n.code,{children:"Request"})," (pedido do tomador)."]}),"\n",(0,r.jsx)(n.li,{children:"Aplica\xe7\xf5es, aprova\xe7\xf5es e funding."}),"\n",(0,r.jsx)(n.li,{children:"Cria\xe7\xe3o do empr\xe9stimo, cronograma, pagamentos, finaliza\xe7\xe3o e marca\xe7\xe3o de inadimpl\xeancia."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Principais entradas/sa\xeddas (APIs p\xfablicas):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"initialize(admin, token, governance_contract, credit_score_contract)"})," \u2014 configura depend\xeancias e contadores iniciais."]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"create_investment_card(investor, max_amount, min_amount, interest_rate, max_installments, target_risk_level) -> u64"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"create_request_card(borrower, requested_amount, desired_installments, preferred_payment_dates, description) -> u64"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"apply_to_investment_card(borrower, card_id, amount) -> u64"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"approve_application(app_id, installments, payment_dates) -> u64"})," \u2014 cria o empr\xe9stimo em nome do investidor."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"fund_request_card(lender, card_id, interest_rate) -> u64"})," \u2014 financia um pedido e cria o empr\xe9stimo."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"make_payment(loan_id) -> bool"})," \u2014 realiza pagamento, atualiza status e registra hist\xf3rico."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mark_as_defaulted(loan_id)"})," \u2014 admin marca como inadimplente ap\xf3s grace period."]}),"\n",(0,r.jsxs)(n.li,{children:["Getters: ",(0,r.jsx)(n.code,{children:"get_loan"}),", ",(0,r.jsx)(n.code,{children:"get_investment_card"}),", ",(0,r.jsx)(n.code,{children:"get_request_card"}),", ",(0,r.jsx)(n.code,{children:"get_payment_history"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Tipos relevantes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Loan { id, borrower, lender, amount, interest_rate, installments, installment_amount, paid_installments, total_paid, status, created_at, next_payment_date, payment_dates }"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"InvestmentCard"}),", ",(0,r.jsx)(n.code,{children:"RequestCard"}),", ",(0,r.jsx)(n.code,{children:"Payment"}),", ",(0,r.jsx)(n.code,{children:"LoanApplication"})]}),"\n",(0,r.jsxs)(n.li,{children:["Enums: ",(0,r.jsx)(n.code,{children:"LoanStatus"}),", ",(0,r.jsx)(n.code,{children:"CardType"}),", ",(0,r.jsx)(n.code,{children:"ApplicationStatus"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Observa\xe7\xf5es:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["O contrato transfere fundos usando ",(0,r.jsx)(n.code,{children:"token::Client"})," e coleta taxa de governan\xe7a (exemplo: 0,5%)."]}),"\n",(0,r.jsxs)(n.li,{children:["Integra\xe7\xe3o com ",(0,r.jsx)(n.code,{children:"credit_score"})," para registrar pagamentos est\xe1 prevista (TODO em coment\xe1rios)."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"deploy-inicializa\xe7\xe3o-e-integra\xe7\xe3o",children:"Deploy, inicializa\xe7\xe3o e integra\xe7\xe3o"}),"\n",(0,r.jsxs)(n.p,{children:["Scripts em ",(0,r.jsx)(n.code,{children:"src/stellar/contracts/deploy/"})," auxiliam todo o ciclo:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"deploy_testnet.sh"})," \u2014 compila e faz deploy dos contratos na testnet, salvando IDs em ",(0,r.jsx)(n.code,{children:"deploy/deployed_contracts_testnet.txt"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"deploy_mainnet.sh"})," \u2014 vers\xe3o interativa para mainnet (cautela; consome XLM real)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"initialize_contracts.sh"})," \u2014 invoca ",(0,r.jsx)(n.code,{children:"initialize"})," em cada contrato, configurando admin, token e taxas."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"integrate_contracts.sh"})," \u2014 configura refer\xeancias cruzadas quando aplic\xe1vel (ex.: ",(0,r.jsx)(n.code,{children:"set_loan_contract"})," no ",(0,r.jsx)(n.code,{children:"credit_score"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"test_contracts.sh"})," e ",(0,r.jsx)(n.code,{children:"test_full_flow.sh"})," \u2014 cen\xe1rios de teste ponta a ponta."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Pr\xe9-requisitos:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"stellar-cli"})," instalado."]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"wallets-crate-wallets",children:["Wallets (crate ",(0,r.jsx)(n.code,{children:"wallets"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["O crate ",(0,r.jsx)(n.code,{children:"wallets"})," oferece utilit\xe1rios para cria\xe7\xe3o e gest\xe3o de carteiras Stellar para perfis de usu\xe1rio Investidor e Tomador."]}),"\n",(0,r.jsx)(n.p,{children:"Componentes principais:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"WalletManager"})," \u2014 gerencia ciclo de vida de m\xfaltiplas wallets em mem\xf3ria."]}),"\n",(0,r.jsxs)(n.li,{children:["Tipos: ",(0,r.jsx)(n.code,{children:"MithrilWallet"}),", ",(0,r.jsx)(n.code,{children:"PublicWalletInfo"}),", ",(0,r.jsx)(n.code,{children:"UserType"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Fun\xe7\xf5es utilit\xe1rias: ",(0,r.jsx)(n.code,{children:"create_stellar_wallet(UserType, nickname)"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Observa\xe7\xf5es de seguran\xe7a:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prefira trabalhar com ",(0,r.jsx)(n.code,{children:"PublicWalletInfo"})," quando poss\xedvel (sem chave secreta)."]}),"\n",(0,r.jsxs)(n.li,{children:["Manipule ",(0,r.jsx)(n.code,{children:"secret_key"})," somente quando indispens\xe1vel e nunca fa\xe7a log em produ\xe7\xe3o."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"refer\xeancias-r\xe1pidas",children:"Refer\xeancias r\xe1pidas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Diret\xf3rio contratos: ",(0,r.jsx)(n.code,{children:"src/stellar/contracts/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Deploy scripts: ",(0,r.jsx)(n.code,{children:"src/stellar/contracts/deploy/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Crate wallets: ",(0,r.jsx)(n.code,{children:"src/stellar/wallets/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Client token utilizado: ",(0,r.jsx)(n.code,{children:"soroban_sdk::token::Client"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"pr\xf3ximos-passos",children:"Pr\xf3ximos passos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Finalizar chamadas cruzadas: ",(0,r.jsx)(n.code,{children:"loan"})," \u2192 ",(0,r.jsx)(n.code,{children:"credit_score.record_payment"})," e integra\xe7\xf5es com ",(0,r.jsx)(n.code,{children:"governance"})," (fundo de prote\xe7\xe3o)."]}),"\n",(0,r.jsx)(n.li,{children:"Adicionar testes unit\xe1rios/integrados adicionais nos contratos."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(6540);const r={},a=s.createContext(r);function o(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);